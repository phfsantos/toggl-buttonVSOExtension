{"version":3,"file":null,"sources":["D:/Pherasoft/Open Source/toggl-buttonVSOExtension/scripts/lib/PomoTogglTimerGroup.ts","D:/Pherasoft/Open Source/toggl-buttonVSOExtension/scripts/lib/PomoTogglTimerSettings.ts","D:/Pherasoft/Open Source/toggl-buttonVSOExtension/scripts/pomoToggleTimer.ts"],"sourcesContent":["// ---------------------------------------------------------------------\r\n// <copyright file=\"TogglButtonForm.ts\">\r\n//    this code is licensed under the MIT License.\r\n//    tHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF \r\n//    aNY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED \r\n//    tO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A \r\n//    pARTICULAR PURPOSE AND NONINFRINGEMENT.\r\n// </copyright>\r\n// <summary>All logic inside TogglButtonForm</summary>\r\n// ---------------------------------------------------------------------\r\n\r\n/// <reference path='../ref/jquery.d.ts' />\r\n/// <reference path='../ref/VSS.d.ts' />\r\n/// <reference path='../ref/chosen.d.ts' />\r\n\r\nlet Notification = (<any>window).Notification;\r\n\r\ninterface ITogglFormResponse {\r\n    activityDescription: string;\r\n    project: string;\r\n    tags: any[];\r\n    apikey: string;\r\n}\r\n\r\ninterface ITogglOpts {\r\n    method: string;\r\n    baseUrl: string;\r\n    token: string;\r\n    crendentials: any;\r\n    onLoad: any;\r\n}\r\n\r\nclass PomoTogglTimerGroup {\r\n    apiKey: string = \"\";\r\n    title: string = \"\";\r\n    currentTimerId: number;\r\n    pomodoriSize: number = 25;\r\n    pomodoriBreak: number = 5;\r\n    formChangedCallbacks: any[];\r\n    workItemFormService: any;\r\n    authenticationService: any;\r\n    controls: any;\r\n    statusIndicator: any;\r\n    dataService: any;\r\n    webContext: any;\r\n    togglApiTokenKey: string;\r\n    timerInterval: number;\r\n    tags: string[];\r\n    project: number;\r\n    STATE_FIELD: string = \"System.State\";\r\n    REASON_FIELD: string = \"System.Reason\";\r\n\r\n    constructor(WorkItemFormService: any, AuthenticationService: any, Controls: any, StatusIndicator: any, dataService: any) {\r\n        this.authenticationService = AuthenticationService;\r\n        this.workItemFormService = WorkItemFormService;\r\n        this.controls = Controls;\r\n        this.statusIndicator = StatusIndicator;\r\n        this.dataService = dataService;\r\n        this.webContext = VSS.getWebContext();\r\n        this.initializeForm();\r\n    }\r\n\r\n    initializeForm() {\r\n        // init buttons\r\n        $(\"#btnStop\").off().click(() => this.stopCurrentTimer());\r\n        $(\"#btnStart\").off().click(() => this.startTimer());\r\n        $(\"#btnDiscard\").off().click(() => this.discardCurrentTimer());\r\n\r\n        this.loadAPIKey().then(() => {\r\n            if (this.apiKey) {\r\n                this.fetchTogglInformations();\r\n            } else {\r\n                this.hideInfosFromToggl();\r\n            }\r\n        });\r\n    };\r\n\r\n    hideInfosFromToggl() {\r\n        $(\"#startTimer\").show();\r\n    }\r\n\r\n    showInfosFromToggl() {\r\n        $(\"#startTimer\").show();\r\n        $(\"#stopTimer\").hide();\r\n    }\r\n\r\n    fetchTogglInformations() {\r\n        $.ajax({\r\n            url: \"./pomoTogglTimer/getUserData\",\r\n            data: { apikey: this.apiKey },\r\n            success: (data: any) => {\r\n                this.errorMessage(null);\r\n                var currentTimer = null;\r\n\r\n                if (data.time_entries) {\r\n                    currentTimer = data.time_entries.find((t: any) => {\r\n                        return t.duration < 0;\r\n                    });\r\n                }\r\n\r\n                if (currentTimer) {\r\n                    this.showCurrentTimer(currentTimer);\r\n                } else {\r\n                    this.getDescriptionInfo();\r\n                    this.showInfosFromToggl();\r\n                }\r\n\r\n                this.workItemFormService.getFieldValues([\r\n                    \"System.TeamProject\",\r\n                    \"System.Tags\",\r\n                ]).then((fields) => {\r\n                    let projectName = fields[\"System.TeamProject\"];\r\n                    let togglProject = (<any[]>data.projects).find((p: any) => {\r\n                        return p.name === projectName;\r\n                    });\r\n                    if (togglProject) {\r\n                        this.project = togglProject.id;\r\n                    } else {\r\n                        $.ajax({\r\n                            url: \"./pomoTogglTimer/createProject\",\r\n                            data: { apikey: this.apiKey, projectName },\r\n                            success: (p) => {\r\n                                console.log(\"new project\", p);\r\n                                this.project = p.id;\r\n                            }\r\n                        });\r\n                    }\r\n                    console.log(projectName, togglProject);\r\n                    this.tags = [\"\"]\r\n                    if (fields[\"System.Tags\"]) {\r\n                        this.tags = fields[\"System.Tags\"].split(\";\");\r\n                    };\r\n                    console.log(this.tags);\r\n                });\r\n            },\r\n            error: (data: any) => {\r\n                this.errorMessage(data.status, data.statusText);\r\n            }\r\n        });\r\n    };\r\n    updateCompletedTime() {\r\n        console.log(\"Updating completed time\");\r\n        $.ajax({\r\n            url: \"./pomoTogglTimer/getUserData\",\r\n            data: { apikey: this.apiKey },\r\n            success: (data) => {\r\n                const COMPLETED_WORK = \"Microsoft.VSTS.Scheduling.CompletedWork\";\r\n                this.workItemFormService.getFieldValue(COMPLETED_WORK).then((completedWork) => {\r\n                    let lastTimeEntry = data.time_entries.pop();\r\n                    let hours = lastTimeEntry.duration / 60 / 60; // duration is in seconds\r\n                    completedWork += hours;\r\n\r\n                    this.workItemFormService.setFieldValue(COMPLETED_WORK, Number(completedWork).toFixed(2)).then((success) => {\r\n                        if (success) {\r\n                            console.log(\"Updated completed time\");\r\n                        } else {\r\n                            console.log(\"could not update\");\r\n                        }\r\n                    }, (err) => {\r\n                        console.log(\"could not update\", err);\r\n                    });\r\n                }, (err) => {\r\n                    console.log(\"could not update\", err);\r\n                });\r\n            },\r\n            error: (data) => {\r\n                this.errorMessage(data.status, data.statusText);\r\n            }\r\n        });\r\n    }\r\n\r\n    addPomodoriEntry() {\r\n        this.dataService.getValue(\"pomodories\").then((pomodories) => {\r\n            pomodories = pomodories? pomodories : 0;\r\n            return this.dataService.setValue(\"pomodories\", ++pomodories);\r\n        });\r\n        this.workItemFormService.getId().then((workItemID) => {\r\n            this.dataService.getValue(`${workItemID}-pomodories`).then((pomodories) => {\r\n                pomodories = pomodories? pomodories : 0;\r\n                return this.dataService.setValue(`${workItemID}-pomodories`, ++pomodories);\r\n            });\r\n            var authTokenManager = this.authenticationService.authTokenManager;\r\n            authTokenManager.getToken().then((token: string) => {\r\n                var header = authTokenManager.getAuthorizationHeader(token);\r\n                $.ajaxSetup({\r\n                    headers: {\r\n                        \"Authorization\": header,\r\n                        \"Accept\": \"application/json; api-version=1.0;\",\r\n                    },\r\n                });\r\n\r\n                var postData = [{\r\n                    \"op\": \"add\",\r\n                    \"path\": \"/fields/System.History\",\r\n                    \"value\": \"Completed a pomodori\"\r\n                }];\r\n\r\n                this.workItemFormService.getWorkItemResourceUrl(workItemID).then((apiURI) => {\r\n                    // var apiURI = this.webContext.collection.uri + \"_apis/wit/workitems/\" + workItemID + \"?api-version=1.0\";\r\n                    $.ajax({\r\n                        type: \"PATCH\",\r\n                        url: apiURI,\r\n                        contentType: \"application/json-patch+json\",\r\n                        data: JSON.stringify(postData),\r\n                        success() {\r\n                            if (console) {\r\n                                console.log(\"History updated successful\");\r\n                            }\r\n                        },\r\n                        error(error: any) {\r\n                            if (console) {\r\n                                console.log(\"Error \" + error.status + \": \" + error.statusText);\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    showCurrentTimer(currentTimer: any) {\r\n        if (this.timerInterval) {\r\n            clearInterval(this.timerInterval);\r\n            this.timerInterval = null;\r\n        }\r\n        $(\"#startTimer\").hide();\r\n        $(\"#stopTimer\").show();\r\n        $(\"#activeActivityTitle\").text(currentTimer.description);\r\n        let start = new Date(currentTimer.start);\r\n        let now = new Date();\r\n        let milliseconds = Math.abs(Number(start) - Number(now));\r\n        this.currentTimerId = currentTimer.id;\r\n        this.timerInterval = setInterval(() => {\r\n            milliseconds += 1000;\r\n            let min = (milliseconds / 1000 / 60) << 0;\r\n            let sec = (milliseconds / 1000) % 60;\r\n            let secZero = sec < 10 ? \"0\" : \"\";\r\n            $(\"#activeActivityStartTime\").text(`${min.toFixed(0)}:${secZero}${sec.toFixed(0)}`);\r\n\r\n            if (min === this.pomodoriSize) {\r\n                this.notify(\"Take a break!\", \"You completed a pomodori. Take a five minutes break.\");\r\n                this.addPomodoriEntry();\r\n                this.breakTime();\r\n                this.stopCurrentTimer();\r\n            }\r\n        }, 1000);\r\n    };\r\n\r\n    startTimer() {\r\n        this.workItemFormService.getId().then((workItemID) => {\r\n            let result = this.getFormInputs();\r\n            $.ajax({\r\n                url: \"./pomoTogglTimer/startTimer\",\r\n                type: \"POST\",\r\n                data: result,\r\n                success: (data) => {\r\n                    this.fetchTogglInformations();\r\n                },\r\n                error: (err) => {\r\n                    alert(\"Not possible to start the timer. Error \" + err.status + \": \" + err.statusText);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    stopCurrentTimer() {\r\n        if (this.timerInterval) {\r\n            clearInterval(this.timerInterval);\r\n            this.timerInterval = null;\r\n        }\r\n        let settings: JQueryAjaxSettings = {\r\n            url: \"./pomoTogglTimer/stopTimer\",\r\n            type: \"PUT\",\r\n            data: { timeEntryId: this.currentTimerId, apikey: this.apiKey },\r\n            success: (data: any, textStatus: string, jqXHR: JQueryXHR) => {\r\n                this.initializeForm();\r\n                this.updateCompletedTime();\r\n            },\r\n            error: (data) => {\r\n                this.errorMessage(data.status, data.statusText);\r\n                clearInterval(this.timerInterval);\r\n            }\r\n        };\r\n        $.ajax(settings);\r\n    };\r\n\r\n    discardCurrentTimer() {\r\n        if (!confirm(\"Do you want to delete this running time entry?\")) {\r\n            return;\r\n        }\r\n\r\n        if (this.timerInterval) {\r\n            clearInterval(this.timerInterval);\r\n            this.timerInterval = null;\r\n        }\r\n        $.ajax({\r\n            url: \"./pomoTogglTimer/discardTimer\",\r\n            type: \"DELETE\",\r\n            data: { timeEntryId: this.currentTimerId, apikey: this.apiKey },\r\n            success: (data: any) => {\r\n                this.initializeForm();\r\n            },\r\n            error: (data: any) => {\r\n                this.errorMessage(data.status, data.statusText);\r\n            }\r\n        });\r\n    }\r\n\r\n    loadAPIKey() {\r\n        return this.dataService.getValue(\"apikey\").then((currentKey) => {\r\n            return this.apiKey = currentKey;\r\n        });\r\n    }\r\n\r\n    errorMessage(status: number = 200, message: string = \"\") {\r\n        var $errorDiv = $(\"#error\");\r\n\r\n        $errorDiv.html(\"\");\r\n\r\n        if (status != null && status !== 200) {\r\n            $(\"#error\").html(\"<p>Error \" + status + \": \" + message + \"</p>\");\r\n        }\r\n    }\r\n\r\n    getDescriptionInfo() {\r\n        this.workItemFormService.getId().then((workItemID) => {\r\n            this.workItemFormService.getFieldValue(\"System.Title\").then((title) => {\r\n                this.title = title + \" (id: \" + workItemID + \")\";\r\n            });\r\n        });\r\n    }\r\n\r\n    getFormInputs(): ITogglFormResponse {\r\n        return {\r\n            activityDescription: this.title,\r\n            project: String(this.project),\r\n            tags: this.tags,\r\n            apikey: this.apiKey\r\n        };\r\n    };\r\n\r\n    notify(title: string, body: string) {\r\n        let options = {\r\n            body,\r\n            badge: \"https://vso-toggl-pomo.azurewebsites.net/images/active-16.png\",\r\n            icon: \"https://vso-toggl-pomo.azurewebsites.net/images/toggl_wide.png\",\r\n            vibrate: [200, 100, 200],\r\n            requireInteraction: true,\r\n        };\r\n        let notification: any;\r\n\r\n        // let's check if the browser supports notifications\r\n        if (!(\"Notification\" in window)) {\r\n            return false;\r\n        } else if (Notification.permission === \"granted\") {// let's check whether notification permissions have already been granted\r\n            // if it's okay let's create a notification\r\n            notification = new Notification(title, options);\r\n        } else if (Notification.permission !== \"denied\") { // otherwise, we need to ask the user for permission\r\n            Notification.requestPermission(function (permission: string) {\r\n                // if the user accepts, let's create a notification\r\n                if (permission === \"granted\") {\r\n                    notification = new Notification(title, options);\r\n                }\r\n            });\r\n        }\r\n\r\n        // finally, if the user has denied notifications and you \r\n        // want to be respectful there is no need to bother them any more.\r\n        return notification;\r\n    }\r\n\r\n    breakTime() {\r\n        let container = $(\"#startTimer.section\");\r\n        let waitControlOptions = {\r\n            cancellable: true,\r\n            cancelTextFormat: `Five minutes break! {0} to skip`,\r\n            cancelCallback: () => {\r\n                this.startTimer();\r\n            }\r\n        };\r\n\r\n        var waitControl: any = this.controls.create(this.statusIndicator.WaitControl, container, waitControlOptions);\r\n        waitControl.startWait();\r\n\r\n        setTimeout(() => {\r\n            this.notify(\"Break is over!\", \"It is time to get back to work.\");\r\n            waitControl.endWait();\r\n        }, this.pomodoriBreak * 60 * 1000);\r\n    }\r\n\r\n    onFormChanged(callback: Function) {\r\n        if (this.formChangedCallbacks) {\r\n            this.formChangedCallbacks.push(callback);\r\n        }\r\n\r\n    };\r\n}\r\n\r\nexport default PomoTogglTimerGroup;\r\n","/// <reference path='../ref/jquery.d.ts' />\r\n/// <reference path='../ref/VSS.d.ts' />\r\n/// <reference path='../ref/chosen.d.ts' />\r\n\r\ninterface ITogglSettingsResponse {\r\n    apikey: string;\r\n    nextState: string;\r\n}\r\n\r\nclass PomoTogglTimerSettings {\r\n    webContext: any;\r\n    dataService: any;\r\n    STATE_FIELD: string = \"System.State\";\r\n    REASON_FIELD: string = \"System.Reason\";\r\n\r\n    constructor(DataService: any) {\r\n        this.dataService = DataService;\r\n        this.webContext = VSS.getWebContext();\r\n        this.loadAPIKey();\r\n        $(\"#btnSave\").click(() => this.saveAPIKey());\r\n    }\r\n\r\n    saveAPIKey() {\r\n        var apiKey = $(\"#txtAPIKey\").val();\r\n\r\n        if (localStorage !== undefined) {\r\n            this.dataService.getValue(\"apikey\").then((currentKey) => {\r\n                if (currentKey === \"\" || currentKey !== apiKey) {\r\n                    this.dataService.setValue(\"apikey\", apiKey).then(() => {\r\n                        console.log(\"Set the api key\");\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    loadAPIKey() {\r\n        this.dataService.getValue(\"apikey\").then((currentKey) => {\r\n            if (currentKey) {\r\n                $(\"#txtAPIKey\").val(currentKey);\r\n            }\r\n        });\r\n    }\r\n\r\n    errorMessage(status: number = 200, message: string = \"\") {\r\n        var $errorDiv = $(\"#error\");\r\n\r\n        $errorDiv.html(\"\");\r\n\r\n        if (status != null && status !== 200) {\r\n            $(\"#error\").html(\"<p>Error \" + status + \": \" + message + \"</p>\");\r\n        }\r\n    }\r\n}\r\n\r\nexport default PomoTogglTimerSettings;\r\n","import PomoTogglTimerGroup from \"./lib/PomoTogglTimerGroup\";\r\nimport PomoTogglTimerSettings from \"./lib/PomoTogglTimerSettings\";\r\n\r\nVSS.init({\r\n    explicitNotifyLoaded: true,\r\n    usePlatformScripts: true,\r\n    usePlatformStyles: true\r\n});\r\n\r\nVSS.require([\r\n    \"TFS/WorkItemTracking/Services\",\r\n    \"VSS/Authentication/Services\",\r\n    \"VSS/Controls\",\r\n    \"VSS/Controls/StatusIndicator\"\r\n], (_WorkItemServices, AuthenticationService, Controls, StatusIndicator) => {\r\n    // get the WorkItemFormService. \r\n    // this service allows you to get/set fields/links on the 'active' work item (the work item\r\n    // that currently is displayed in the UI).\r\n    function getWorkItemFormService() {\r\n        return _WorkItemServices.WorkItemFormService.getService();\r\n    }\r\n\r\n    getWorkItemFormService().then((WorkItemFormService) => {\r\n        VSS.getService(VSS.ServiceIds.ExtensionData).then((dataService) => {\r\n            var pomoTogglTimerGroup = new PomoTogglTimerGroup(WorkItemFormService,\r\n                                                              AuthenticationService,\r\n                                                              Controls,\r\n                                                              StatusIndicator,\r\n                                                              dataService);\r\n            VSS.register(\"pomoTogglTimerGroup\", pomoTogglTimerGroup);\r\n        });\r\n    });\r\n});\r\n\r\n// ready\r\nVSS.ready(() => {\r\n    // get the data service\r\n    VSS.getService(VSS.ServiceIds.ExtensionData).then((dataService) => {\r\n        var pomoTogglTimerSettings = new PomoTogglTimerSettings(dataService);\r\n        VSS.register(\"PomoTogglTimerSettings\", pomoTogglTimerSettings);\r\n    });\r\n\r\n    // notify loaded\r\n    VSS.notifyLoadSucceeded();\r\n});"],"names":[],"mappings":"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"}